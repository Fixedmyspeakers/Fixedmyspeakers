<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="images/favicon.png.png">
  <title>Fix My Speakers - Eject water from your phone's speakers</title>
  <!-- SEO Meta Tags -->
  <meta name="description" content="Fix your speaker online using sound waves to eject water and clean your phone speaker. Works on Android and iPhone ‚Äì 100% free and safe.">
  <meta name="keywords" content="fix my speaker, speaker cleaner, water out of speaker, remove water from speaker, speaker repair tool, fix speaker sound online, phone speaker water remover, fix my speaker cleaner, fix my call speaker dust, fix my speaker water, clean my speaker dust, fix my speaker bass, call speaker cleaner, ear speaker cleaner sound, fix my speaker high speed water, fixed my speaker">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://fixedmyspeaker.com/">

  <!-- Open Graph (Facebook/LinkedIn) -->
  <meta property="og:title" content="Fix My Speaker | Online Water Remover Tool">
  <meta property="og:description" content="Use this online tool to remove water from your speaker using high-frequency sound. 100% free and works on all devices.">
  <meta property="og:image" content="https://fixedmyspeaker.com/images/speaker-cleaner-preview.jpg">
  <meta property="og:url" content="https://fixedmyspeaker.com/">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Fix My Speaker | Speaker Cleaner Tool">
  <meta name="twitter:description" content="Eject water from your speaker using high-frequency sound. Fast, safe, and online.">
  <meta name="twitter:image" content="https://fixedmyspeaker.com/images/speaker-cleaner-preview.jpg">

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Fix My Speaker",
    "url": "https://fixedmyspeaker.com",
    "applicationCategory": "UtilitiesApplication",
    "operatingSystem": "All",
    "description": "Clean your phone speaker online using water-ejecting sound waves.",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    }
  }
  </script>

<style>
   /* CSS Variables for Theming */
   :root {
     --primary: #FFA500; /* Orange */
     --primary-text: #FFFFFF;
     --success: #28a745;
     --danger: #dc3545;

     /* Light Theme Defaults */
     --light-bg: #f0f4f8;
     --light-text: #222222;
     --light-text-muted: #555555;
     --light-card-bg: #FFFFFF;
     --light-border: #dddddd;
     --light-header-bg-start: #007bff;
     --light-header-bg-end: #6610f2;
     --light-header-text: #FFFFFF;
     --light-footer-bg: #f1f1f1;
     --light-footer-text: #444444;
     --light-input-bg: #FFFFFF;
     --light-input-border: #cccccc;
     --light-input-text: #333333;
     --light-loader-bg: #FFFFFF;
     --light-loader-text: #000000;
     --light-loader-spinner: #000000;
     --light-viz-bg: #e9e9e9; /* Was #222 which is too dark for light */
     --light-link-color: #007bff;
     --light-faq-question-bg: #f9f9f9;
     --light-faq-question-hover-bg: #e0f7fa;
     --light-profile-menu-bg: #fff;
     --light-profile-menu-border: #eee;
     --light-profile-menu-item-hover: #f0f0f0;

     /* Dark Theme Values */
     --dark-bg: #121212;
     --dark-text: #e0e0e0;
     --dark-text-muted: #aaaaaa;
     --dark-card-bg: #1e1e1e;
     --dark-border: #444444;
     --dark-header-bg-start: #1a2330;
     --dark-header-bg-end: #2c1a3b;
     --dark-header-text: #e0e0e0;
     --dark-footer-bg: #1a1a1a;
     --dark-footer-text: #aaaaaa;
     --dark-input-bg: #2a2a2a;
     --dark-input-border: #555555;
     --dark-input-text: #e0e0e0;
     --dark-loader-bg: #000000;
     --dark-loader-text: #FFFFFF;
     --dark-loader-spinner: #FFFFFF;
     --dark-viz-bg: #222222;
     --dark-link-color: #64b5f6;
     --dark-faq-question-bg: #2c2c2c;
     --dark-faq-question-hover-bg: #383838;
     --dark-profile-menu-bg: #282828;
     --dark-profile-menu-border: #444;
     --dark-profile-menu-item-hover: #333;


     /* Current Theme Variables (initially light) */
     --current-bg: var(--light-bg);
     --current-text: var(--light-text);
     --current-text-muted: var(--light-text-muted);
     --current-card-bg: var(--light-card-bg);
     --current-border: var(--light-border);
     --current-header-bg-start: var(--light-header-bg-start);
     --current-header-bg-end: var(--light-header-bg-end);
     --current-header-text: var(--light-header-text);
     --current-footer-bg: var(--light-footer-bg);
     --current-footer-text: var(--light-footer-text);
     --current-input-bg: var(--light-input-bg);
     --current-input-border: var(--light-input-border);
     --current-input-text: var(--light-input-text);
     --current-loader-bg: var(--light-loader-bg);
     --current-loader-text: var(--light-loader-text);
     --current-loader-spinner: var(--light-loader-spinner);
     --current-viz-bg: var(--light-viz-bg);
     --current-link-color: var(--light-link-color);
     --current-faq-question-bg: var(--light-faq-question-bg);
     --current-faq-question-hover-bg: var(--light-faq-question-hover-bg);
     --current-profile-menu-bg: var(--light-profile-menu-bg);
     --current-profile-menu-border: var(--light-profile-menu-border);
     --current-profile-menu-item-hover: var(--light-profile-menu-item-hover);
   }

   body.dark-mode {
     --current-bg: var(--dark-bg);
     --current-text: var(--dark-text);
     --current-text-muted: var(--dark-text-muted);
     --current-card-bg: var(--dark-card-bg);
     --current-border: var(--dark-border);
     --current-header-bg-start: var(--dark-header-bg-start);
     --current-header-bg-end: var(--dark-header-bg-end);
     --current-header-text: var(--dark-header-text);
     --current-footer-bg: var(--dark-footer-bg);
     --current-footer-text: var(--dark-footer-text);
     --current-input-bg: var(--dark-input-bg);
     --current-input-border: var(--dark-input-border);
     --current-input-text: var(--dark-input-text);
     --current-loader-bg: var(--dark-loader-bg);
     --current-loader-text: var(--dark-loader-text);
     --current-loader-spinner: var(--dark-loader-spinner);
     --current-viz-bg: var(--dark-viz-bg);
     --current-link-color: var(--dark-link-color);
     --current-faq-question-bg: var(--dark-faq-question-bg);
     --current-faq-question-hover-bg: var(--dark-faq-question-hover-bg);
     --current-profile-menu-bg: var(--dark-profile-menu-bg);
     --current-profile-menu-border: var(--dark-profile-menu-border);
     --current-profile-menu-item-hover: var(--dark-profile-menu-item-hover);
   }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--current-bg);
      color: var(--current-text);
      margin: 0;
      padding: 0;
      transition: background 0.2s, color 0.2s;
      line-height: 1.6;
    }

    header {
      background: linear-gradient(to right, var(--current-header-bg-start), var(--current-header-bg-end));
      color: var(--current-header-text);
      text-align: center;
      padding: 40px 20px;
      position: relative; 
    }
    /* Ensure label for language select in header has correct color */
    header label[for="languageSelect"] {
        font-weight: 600;
        color: var(--current-header-text) !important; /* Override inline black */
    }
     header #languageSelect {
        background-color: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: var(--current-header-text);
    }
    header #languageSelect option {
        background-color: var(--current-input-bg); 
        color: var(--current-text);
    }

    header h1 {
      font-size: 2.4rem;
      margin-bottom: 10px;
    }

    header p {
      font-size: 1.1rem;
      max-width: 700px;
      margin: auto;
    }

    select { /* General select styling */
      margin-top: 10px;
      padding: 5px;
      font-size: 1rem;
      border-radius: 4px;
      cursor: pointer;
      background-color: var(--current-input-bg);
      color: var(--current-input-text);
      border: 1px solid var(--current-input-border);
    }
    select option { /* Options within select */
        background-color: var(--current-input-bg);
        color: var(--current-input-text);
    }

    main {
      padding: 30px 20px;
      max-width: 960px; /* Original had 900px in a later style, using 960px from first */
      margin: auto;
    }
    /* General Section styling */
    section {
      background: var(--current-card-bg); /* Default to card background */
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem; /* was 40px, then 2rem */
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      opacity: 0; /* For animation */
      transform: translateY(30px); /* For animation */
      animation: fadeInUp 1s forwards;
    }
    section:nth-child(even) { animation-delay: 0.2s; }
    section:nth-child(odd) { animation-delay: 0.4s; }

    body.dark-mode section {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    /* Sections that should be transparent (like blog wrapper) can override background */
    #blog-section, #testimonial-section, #ratingWidgetContainer /* Example for a wrapper */ {
        background: transparent;
        box-shadow: none;
        padding: 0; /* If it's just a wrapper */
    }


    h1, h2, h3, h4, h5, h6 {
        color: var(--current-text);
        margin-top: 0; /* From a later style block */
    }
    p, li {
        font-size: 1rem; /* Default from later style block */
        color: var(--current-text);
    }
    ul {
        padding-left: 1.2rem; /* From a later style block */
    }
    li {
        margin-bottom: 0.5rem; /* From a later style block */
    }
    strong {
        color: var(--current-text); /* Ensure contrast */
    }
    a {
        color: var(--current-link-color);
        text-decoration: none; /* Common practice */
    }
    a:hover {
        text-decoration: underline; /* Common practice */
        filter: brightness(85%);
    }


    .btn {
      padding: 12px 20px;
      margin: 10px 5px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    .start { background-color: var(--success); color: var(--primary-text); }
    .stop { background-color: var(--danger); color: var(--primary-text); }
    .mode, .share { background-color: var(--primary); color: var(--primary-text); }

    input[type="range"]#freqSlider { /* Specific to freqSlider */
      width: 100%;
      margin-top: 10px;
      -webkit-appearance: none;
      height: 10px;
      background: linear-gradient(to right, #007bff, #FF0000); /* Hardcoded gradient */
      border-radius: 5px;
      outline: none;
      transition: background 0.3s;
      margin-bottom: 12px;
    }
    /* For other range inputs, consider accent-color or simpler styling */
    input[type="range"]:not(#freqSlider) {
        accent-color: var(--primary);
    }


    canvas#audioVisualizer { /* Renamed for clarity if there are multiple canvases */
      display: block;
      width: 100%;
      height: 100px;
      background: var(--current-viz-bg);
      margin-top: 20px;
      border-radius: 8px;
    }


    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.9rem;
      background-color: var(--current-footer-bg);
      color: var(--current-footer-text);
    }

 
    #loader {
      position: fixed;
      inset: 0;
      background: var(--current-loader-bg);
      color: var(--current-loader-text);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.8rem;
      flex-direction: column;
    }

    #loader::after {
      content: '';
      width: 40px;
      height: 40px;
      border: 4px solid var(--current-loader-spinner);
      border-top: 4px solid transparent;
      border-radius: 50%;
      margin-top: 20px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @keyframes fadeInUp { /* For section animations */
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 600px) {
      header h1 { font-size: 1.8rem; }
      .btn {
        display: block;
        width: 100%;
        margin: 8px 0;
      }
      section { padding: 1.2rem; }
      h2 { font-size: 1.25rem; }
      p, li { font-size: 0.95rem; }
      .blog-item h3 { font-size: 1rem; }
      .blog-item p { font-size: 0.9rem; }
    }


    /* Dark Mode Toggle Switch Styles */
   .theme-switch-wrapper {
       display: flex;
       align-items: center;
       position: absolute;
       top: 20px; /* Adjusted for better alignment */
       right: 20px; 
       z-index: 100;
   }
   .theme-switch {
       display: inline-block;
       height: 24px;
       position: relative;
       width: 50px;
   }
   .theme-switch input {
       display:none;
   }
   .slider {
       background-color: #777; 
       bottom: 0;
       cursor: pointer;
       left: 0;
       position: absolute;
       right: 0;
       top: 0;
       transition: .4s;
   }
   .slider:before {
       background-color: #fff;
       bottom: 4px;
       content: "";
       height: 16px;
       left: 4px;
       position: absolute;
       transition: .4s;
       width: 16px;
   }
   input:checked + .slider {
       background-color: var(--primary);
   }
   input:checked + .slider:before {
       transform: translateX(26px);
   }
   .slider.round {
       border-radius: 34px;
   }
   .slider.round:before {
       border-radius: 50%;
   }
   .theme-switch-wrapper span.icon {
       margin: 0 8px;
       color: var(--current-header-text); 
       font-size: 1.2rem;
       line-height: 1;
       user-select: none;
   }
   body.dark-mode .theme-switch-wrapper span.icon#theme-icon-light {
       color: var(--dark-header-text);
   }
   body.dark-mode .theme-switch-wrapper span.icon#theme-icon-dark {
       color: var(--primary); /* Highlight active mode icon */
   }
   body:not(.dark-mode) .theme-switch-wrapper span.icon#theme-icon-light {
       color: var(--primary); /* Highlight active mode icon */
   }
   body:not(.dark-mode) .theme-switch-wrapper span.icon#theme-icon-dark {
       color: var(--light-header-text);
   }
  
    /* Cleaning Panel Specific Text Colors (overriding inline styles if any) */
    main label[for="freqSlider"], 
    main #timerLabel, 
    main .voice-assistant label,
    section p#frequencyLabel { /* More specific */
        color: var(--current-text) !important;
    }
    section p#frequencyLabel { /* Target for "Current Frequency: ..." text */
        color: var(--current-text-muted) !important;
    }
    main #timerLabel > span#countdown { /* Ensure countdown number is also themed */
        color: var(--current-text) !important;
    }
    .share-buttons p {
        color: var(--current-text) !important;
    }

    /* Informational text styling (How it works, about, features, terms, privacy) */
    /* Applied through general p, h2, strong, a rules. Inline styles were removed/updated. */
    /* For example: */
    /* <h2 style="text-align: center; font-size: 32px; margin-bottom: 30px;">How It Works üõ†</h2>
       <p style="font-size: 18px; line-height: 1.7; text-align: justify; margin-bottom: 10px;"> */
    /* The color will come from general h2, p rules. */

  </style>
</head>
<body class=""> <!-- class="dark-mode" will be added by JS -->

  <div id="loader">Loading Tool...</div>

  <header>
    <h1 id="headerTitle">Fix My Speakers üîä</h1>
    <p id="headerDescription">Eject üí¶ water from your phone's speakers after getting it wet.</p>
   
   <label for="languageSelect">üåê Choose Language:</label> <!-- Removed inline style, handled by CSS -->
    <select id="languageSelect" onchange="changeLanguage(event)" aria-label="Select Language">
      <option value="en">English</option>
      <option value="ne">Nepali</option>
      <option value="hi">Hindi</option>
    </select>

    <div class="theme-switch-wrapper">
     
        <label class="theme-switch" for="darkModeToggleCheckbox">
            <input type="checkbox" id="darkModeToggleCheckbox" aria-label="Toggle dark mode">
            <span class="slider round"></span>
        </label>
       
    </div>

    <!-- Original WhatsApp Button from header (this was one of several) -->
    <!-- Consider consolidating WhatsApp buttons if they serve same purpose -->
    <a href="https://wa.me/+9779827801575" target="_blank" class="whatsapp-btn" onclick="playClickSound()" aria-label="Share on WhatsApp (header)">
      <img src="https://www.freepnglogos.com/uploads/whatsapp-logo-png-transparent-20.png" alt="WhatsApp icon" />
      Share Tool on WhatsApp
    </a>
    <!-- This is a different styled WhatsApp button. If needed, keep, otherwise remove if redundant. -->
    <!-- The one at bottom-left is more prominent. -->

  </header>

  <main>
   <section> <!-- This is the Cleaning Panel Section -->
    <fieldset aria-labelledby="cleaningPanelTitle" style="border: none; padding: 5px 0;">
        <legend id="cleaningPanelTitle" style="font-size: 24px; font-weight: bold;">üßº Cleaning Panel</legend>
        <!-- The style for color is now handled by main CSS h2 rule -->
    
       <div style="margin: 30px auto; padding: 20px; max-width: 500px; background: var(--current-card-bg); border: 1px solid var(--current-border); border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); font-family: Arial, sans-serif;">
            <label for="freqSlider" id="freqLabelText"> <!-- Removed inline style -->
                üéöÔ∏è Frequency Control
            </label>
            <input
                id="freqSlider"
                type="range"
                min="100"
                max="1000"
                value="440"
                step="1"
                oninput="updateFrequencyLabel()"
                aria-labelledby="freqLabelText"
            > <!-- Style for freqSlider is in CSS -->
            <p id="frequencyLabel"> <!-- Removed inline style -->
                Current Frequency: <strong><span id="freqLabel">440</span></strong> Hz
            </p>
        </div>
    
        <div>
          <p id="timerLabel">üïí Timer: <span id="countdown">30</span> sec</p> <!-- Removed inline style -->
        </div>
    </fieldset>
    
    <div class="voice-assistant">
        <label for="langSelect">Assistant Language:</label> <!-- Removed inline style -->
        <select id="langSelectVoice" aria-label="Select assistant language"> <!-- Changed ID to avoid conflict -->
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
          <option value="ne">‡§®‡•á‡§™‡§æ‡§≤‡•Ä</option>
        </select>
        <button id="voiceGuideBtn" aria-label="Play voice guide">Guide Me</button>
    </div>
    
    <button class="btn start" onclick="startCleaning()" id="startBtn">‚ñ∂Ô∏è Start</button> <!-- Removed parseInt from onclick, handle in JS -->
    <button class="btn stop" onclick="stopSound()" id="stopBtn">‚èπÔ∏è Stop</button>

    <div class="share-buttons">
        <p>Share your experience:</p> <!-- Removed inline style -->
        <a id="whatsappShare" class="share-btn whatsapp" target="_blank" title="Share on WhatsApp">WhatsApp</a>
        <a id="facebookShare" class="share-btn facebook" target="_blank" title="Share on Facebook">Facebook</a>
        <!-- <a id="gmailShare" class="share-btn gmail" target="_blank" title="Share on Gmail">Gmail</a> --> <!-- Uncomment if needed -->
    </div>
</section>

<style>
/* Styles for .voice-assistant and .share-buttons specific to this section */
.voice-assistant {
  text-align: center;
  margin: 20px auto;
  font-family: sans-serif;
}
.voice-assistant select,
.voice-assistant button {
  margin: 8px;
  padding: 8px 14px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid var(--current-border);
  background-color: var(--current-input-bg);
  color: var(--current-input-text);
}
#voiceGuideBtn {
  background: var(--success);
  color: var(--primary-text);
  border: none;
  cursor: pointer;
}
#voiceGuideBtn:hover { filter: brightness(90%); }

.share-buttons { text-align: center; margin-top: 20px; font-size: 14px; }
.share-btn {
  display: inline-block; margin: 6px 10px; padding: 8px 14px;
  border-radius: 6px; text-decoration: none; font-weight: 600;
  color: white; /* Text on brand color buttons */
  transition: background 0.3s;
}
.whatsapp { background: #0a7c38; } /* Brand color */
.facebook { background: #2d4c91; } /* Brand color */
.share-btn:hover { opacity: 0.9; }
</style>

<!-- How It Works Section -->
<section id="how-it-works">
    <h2 style="text-align: center; font-size: 32px; margin-bottom: 30px;">How It Works üõ†</h2>
    <p style="font-size: 18px; line-height: 1.7; text-align: justify; margin-bottom: 10px;">
      <strong>FixMySpeaker.com</strong> is a free online tool designed to remove water, dust, and debris from your phone‚Äôs speaker using sound waves.
    </p>
    <div style="position: relative; width: 100%; padding-bottom: 56.25%; margin: 20px 0;">
      <iframe src="https://streamable.com/e/5r71jy?autoplay=1&muted=1&nocontrols=1"
              allow="autoplay; fullscreen" allowfullscreen title="How FixMySpeaker Works"
              style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;">
      </iframe>
    </div>
    <p style="font-size: 18px; line-height: 1.8; text-align: justify;">
      By playing specific high-frequency audio, it helps vibrate and clear blockages from the speaker grill...
      <br><br>
      Trusted by thousands, <strong><a href="https://fixedmyspeaker.com" target="_blank">FixedMySpeaker.com</a></strong> offers an easy, effective way...
    </p>
</section>

<!-- About Us Section -->
<section id="about-us">
    <h2 style="text-align: center; font-size: 32px; margin: 60px 0 30px;">About Us üë®‚Äçüíª</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-start; margin-bottom: 30px;">
      <img src="https://i.postimg.cc/PJ1dPKrG/IMG-6348-Original.jpg" alt="Bishal Mishra" style="width: 300px; border-radius: 12px;">
      <p style="font-size: 18px; line-height: 1.8; text-align: justify; flex: 1;">
        <strong>FixedMySpeaker.com</strong> was founded by Bishal Mishra...
        <br><br>
        For support or inquiries, you can reach out to Bishal directly at <a href="tel:+9779827801575">+977 9827801575</a>. Visit the official website at <a href="https://www.fixedmyspeaker.com" target="_blank">www.fixedmyspeaker.com</a>.
      </p>
    </div>
</section>

<!-- Features Section -->
<section id="features">
    <h2 style="text-align: center; font-size: 32px; margin-bottom: 30px;">Features</h2>
    <ul style="list-style: none; padding: 0; font-size: 18px; line-height: 1.8;">
      <li>High-frequency sound cleaning for dust and water removal</li>
      <li>Works on all smartphones, tablets, and speakers</li>
      <li>Simple and intuitive interface ‚Äî no app download required</li>
      <li>Fully browser-based, no data is sent anywhere</li>
      <li>Smart cleaning tips and usage guide included</li>
      <li>100% free to use with no hidden costs</li>
    </ul>
</section>

<!-- Terms & Conditions Section -->
<section id="terms">
    <h2 style="text-align: center; font-size: 32px; margin: 60px 0 30px;">Terms & Conditions ‚ö†Ô∏è</h2>
    <p style="font-size: 18px; line-height: 1.8; text-align: justify;">
      By using <strong>FixedMySpeaker.com</strong>, you agree to use the tool at your own risk...
    </p>
</section>

<!-- Privacy Policy Section -->
<section id="privacy">
    <h2 style="text-align: center; font-size: 32px; margin: 60px 0 30px;">Privacy Policy üîí</h2>
    <p style="font-size: 18px; line-height: 1.8; text-align: justify;">
      <strong>FixedMySpeaker.com</strong> respects your privacy...
    </p>
</section>


  <section class="animate" aria-labelledby="blogsTitle" id="blog-section"> 
    <h2 id="blogsTitle" style="text-align: center; font-size: 32px;">üì∞ Blogs & News</h2>
    <div id="blogContainer"></div>
  </section>

<style>
   #blog-section { /* This is a wrapper, should be transparent */
    background: transparent !important;
    box-shadow: none !important;
    padding: 20px 0 !important; /* Add some padding if needed */
    margin-bottom: 2rem;
  }
  .blog-item { /* Actual blog items have background */
    background: var(--current-card-bg);
    margin-bottom: 1.5rem;
    padding: 1rem;
    border-left: 5px solid var(--primary);
    border-radius: 5px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  }
  body.dark-mode .blog-item {
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  .blog-item h3 {
    margin-bottom: 0.5rem;
    font-size: 1.2rem;
    color: var(--current-link-color);
  }
  .blog-item p {
    margin: 0.5rem 0;
    color: var(--current-text-muted); /* Summary text */
  }
  .read-more {
    display: inline-block;
    margin-top: 0.5rem;
    text-decoration: none;
    color: var(--primary);
    font-weight: bold;
    cursor: pointer;
  }
  .read-more:hover { text-decoration: underline; }
  .blog-full {
    display: none;
    margin-top: 0.5rem;
    font-size: 0.95rem;
    line-height: 1.6;
  }
  .blog-full p { /* Full blog content text */
      color: var(--current-text);
  }
</style>

<script>
  const blogs = [
    {
      title: "üîä The Science Behind Speaker Cleaning",
      summary: "How high-frequency sound removes dust and water from your phone's speaker.",
      author: "Bishal Mishra",
      date: "May 10, 2025",
      content: `High-frequency sound waves cause micro vibrations that help shake loose water droplets and dust particles trapped in the speaker grill. This method is inspired by the same technology used in ultrasonic cleaning for jewelry and electronics. Our tool utilizes carefully tested audio tones that are loud but safe for your hardware. Avoid using very low frequencies below 80Hz or extremely high tones above 20kHz.`
    },
    {
      title: "üì± 3 Simple Tricks to Maintain Clean Speakers",
      summary: "Prevent buildup and keep your phone speaker sounding crisp.",
      author: "Narayan Giri",
      date: "May 5, 2025",
      content: `1. Keep your phone away from high humidity areas like bathrooms. 2. Use a soft toothbrush to gently clean the grill once a week. 3. Use our cleaning tool after any exposure to sweat, rain, or moisture. A regular cleaning routine will keep your audio output loud and clear.`
    },
    { title: "üÜï Update: New Cleaning Mode Added!", summary: "We‚Äôve added a new powerful cleaning pulse for deeper water expulsion.", author: "Neha Jaiswal", date: "May 2, 2025", content: `Our new mode alternates between 300Hz and 1500Hz in a loop to target different types of debris and moisture...`},
    { title: "üõ†Ô∏è How to Fix Muffled Phone Speaker", summary: "Is your phone speaker quiet or unclear? Here's how to restore it.", author: "Prashant Mishra", date: "April 28, 2025", content: `If your speaker sounds muffled: ‚Ä¢ First dry it with a soft cloth...`},
    { title: "üåä Water in Your Speaker? Here‚Äôs What to Do", summary: "Quickly remove water from your phone speaker safely.", author: "Nikhil Mishra", date: "April 22, 2025", content: `Avoid using heat or compressed air. Instead: ‚Ä¢ Play our cleaning tone with volume maxed...`},
    { title: "üìä Do Sound Wave Cleaners Actually Work?", summary: "We tested multiple sound-based speaker cleaner tools.", author: "Anam Mishra", date: "April 15, 2025", content: `Out of 5 tools tested, only 2 expelled visible moisture. Our tool ranked #1...`},
    { title: "üîÑ How Often Should You Clean Your Phone Speaker?", summary: "Best cleaning schedule for healthy audio output.", author: "Summit Maharjan", date: "April 8, 2025", content: `Light users can clean once a month. But if you're often outdoors...`},
    { title: "üéß Why Does Speaker Sound Get Worse After Water Exposure?", summary: "Understanding temporary sound distortion after contact with water.", author: "Sandeep Pandey", date: "April 2, 2025", content: `Water can block speaker membranes or form droplets in the grill mesh...`},
    { title: "üì¶ Behind the Scenes: How We Built This Tool", summary: "A look into the tech and testing behind our speaker cleaner.", author: "Barun Jha", date: "March 28, 2025", content: `We experimented with various tone patterns, from sawtooth waves to low-frequency pulses...`}
  ];

    const blogContainer = document.getElementById('blogContainer');
    if (blogContainer) { // Check if element exists
        blogs.forEach((blog, index) => {
            const blogItem = document.createElement('article');
            blogItem.className = 'blog-item animate'; // Added animate class
            blogItem.innerHTML = `
            <h3>${blog.title}</h3>
            <p>${blog.summary}</p>
            <p><small>By <strong>${blog.author}</strong> ‚Ä¢ ${blog.date}</small></p>
            <a class="read-more" href="#blog-full-${index}" onclick="toggleBlogDetails(event, ${index})">Read more ‚Üí</a>
            <div class="blog-full" id="blog-full-${index}" style="display:none;">
                <p>${blog.content}</p>
            </div>
            `;
            blogContainer.appendChild(blogItem);
        });
    }


  function toggleBlogDetails(event, index) {
    event.preventDefault();
    const el = document.getElementById('blog-full-' + index);
    if (el) {
        el.style.display = el.style.display === 'none' || el.style.display === '' ? 'block' : 'none';
    }
  }
</script>

<!-- üîº Scroll-to-Top Button -->
<button id="scrollTopBtn" aria-label="Scroll to Top" style="display: none;"> <!-- Initially hidden -->
  <svg width="50" height="60" viewBox="0 0 100 100">
    <circle cx="50" cy="50" r="45" stroke="var(--current-border)" stroke-width="10" fill="none" />
    <circle id="progressCircle" cx="50" cy="50" r="45" stroke="var(--current-text)" stroke-width="10" fill="none"
      stroke-linecap="round" transform="rotate(-90 50 50)" stroke-dasharray="282.6" stroke-dashoffset="282.6" />
    <text x="50" y="58" text-anchor="middle" font-size="40" fill="var(--current-text)">‚Üë</text>
  </svg>
</button>
<style>
  #scrollTopBtn {
    position: fixed; bottom: 25px; right: 25px; z-index: 9999;
    background: transparent; border: none; cursor: pointer;
    width: 60px; height: 60px; border-radius: 50%; padding: 0;
    /* display: none; /* Handled by JS */
  }
  #scrollTopBtn:hover text { fill: var(--primary); }
</style>
<script>
  const scrollBtn = document.getElementById("scrollTopBtn");
  const progressCircle = document.getElementById("progressCircle");
  
  if (scrollBtn && progressCircle) { // Check if elements exist
      const circumference = 2 * Math.PI * 45;

      function updateScrollProgress() {
        const scrollTop = window.scrollY || document.documentElement.scrollTop;
        const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const percentScrolled = scrollHeight > 0 ? scrollTop / scrollHeight : 0; // Avoid division by zero
        const offset = circumference * (1 - percentScrolled);

        progressCircle.style.strokeDashoffset = offset;
        scrollBtn.style.display = scrollTop > 100 ? "block" : "none";
      }

      scrollBtn.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      window.addEventListener("scroll", updateScrollProgress);
      document.addEventListener("DOMContentLoaded", updateScrollProgress); // Initial check
  }
</script>

<!-- FAQ SECTION -->
<section class="animate" itemscope itemtype="https://schema.org/FAQPage" id="faq-section-wrapper">
  <h2 id="faqTitle">Frequently Asked Questions (FAQ)</h2>
  <div class="faq-search">
    <input type="text" id="faqSearch" placeholder="Search your question... üîç">
  </div>
  <div class="faq-toggle">
    <button onclick="toggleAllFaq(true)">Expand All</button>
    <button onclick="toggleAllFaq(false)">Collapse All</button>
  </div>
  <div class="faq-container" id="faqContainer">
    <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
      <div class="faq-question"><span itemprop="name">How does this speaker cleaner tool work?</span><span class="faq-arrow">‚ñ∂Ô∏è</span></div>
      <div class="faq-answer" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer"><div itemprop="text">It plays sound waves that vibrate your speaker, helping eject water and dust stuck inside.</div><div class="faq-voice" onclick="speakFaqText(this)">üîä Speak</div></div>
    </div>
    <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
      <div class="faq-question"><span itemprop="name">Is it compatible with all smartphones?</span><span class="faq-arrow">‚ñ∂Ô∏è</span></div>
      <div class="faq-answer" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer"><div itemprop="text">Yes, the tool works with iPhones, Android phones, and most modern smartphones with built-in speakers.</div><div class="faq-voice" onclick="speakFaqText(this)">üîä Speak</div></div>
    </div>
    <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
      <div class="faq-question"><span itemprop="name">How many times should I run the cleaning?</span><span class="faq-arrow">‚ñ∂Ô∏è</span></div>
      <div class="faq-answer" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer"><div itemprop="text">Running it 2‚Äì3 times is usually enough, especially after water exposure.</div><div class="faq-voice" onclick="speakFaqText(this)">üîä Speak</div></div>
    </div>
    <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
      <div class="faq-question"><span itemprop="name">Is this tool free and safe?</span><span class="faq-arrow">‚ñ∂Ô∏è</span></div>
      <div class="faq-answer" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer"><div itemprop="text">Yes, it is 100% free and runs directly in your browser without collecting data.</div><div class="faq-voice" onclick="speakFaqText(this)">üîä Speak</div></div>
    </div>
    <div class="faq-item" itemscope itemprop="mainEntity" itemtype="https://schema.org/Question">
      <div class="faq-question"><span itemprop="name">Can it repair physical speaker damage?</span><span class="faq-arrow">‚ñ∂Ô∏è</span></div>
      <div class="faq-answer" itemscope itemprop="acceptedAnswer" itemtype="https://schema.org/Answer"><div itemprop="text">No, it only helps with water or dust. For hardware issues, consult a technician.</div><div class="faq-voice" onclick="speakFaqText(this)">üîä Speak</div></div>
    </div>
  </div>
</section>
<style>
  #faq-section-wrapper { /* Styles for FAQ elements */
    background: var(--current-card-bg); /* It's a section, so give it card bg */
  }
  #faqTitle {
    margin-top: 0; /* Reset from general section h2 */
    font-size: 28px; color: var(--current-text); text-align: center;
    border-bottom: 2px solid var(--current-border);
    padding-bottom: 10px; margin-bottom: 20px;
  }
  .faq-search input {
    width: 100%; padding: 12px 16px; border-radius: 25px;
    border: 1px solid var(--current-input-border); font-size: 16px; outline: none;
    background-color: var(--current-input-bg); color: var(--current-input-text);
  }
  .faq-toggle button {
    background-color: var(--primary); color: var(--primary-text);
    border: none; padding: 10px 16px; margin: 0 5px;
    border-radius: 20px; cursor: pointer; font-weight: bold;
  }
  .faq-item {
    margin-bottom: 15px; border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.07); overflow: hidden;
    background: var(--current-card-bg); /* Inner items on card background */
    border-left: 5px solid var(--primary);
  }
  body.dark-mode .faq-item { box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .faq-question {
    background: var(--current-faq-question-bg); padding: 18px 20px;
    font-size: 17px; font-weight: 600; cursor: pointer; position: relative;
    transition: background 0.3s ease; display: flex;
    justify-content: space-between; align-items: center; color: var(--current-text);
  }
  .faq-question:hover { background: var(--current-faq-question-hover-bg); }
  .faq-arrow { font-size: 20px; transition: transform 0.3s ease; }
  .faq-item.active .faq-arrow { transform: rotate(90deg); }
  .faq-answer {
    padding: 15px 20px; font-size: 15px; color: var(--current-text-muted);
    display: none; background: var(--current-card-bg);
    border-top: 1px solid var(--current-border); line-height: 1.6;
  }
  .faq-item.active .faq-answer { display: block; animation: slideDownFaq 0.3s ease-out; }
  .faq-voice {
    margin-top: 10px; font-size: 13px; color: var(--primary);
    cursor: pointer; text-align: right;
  }
  @keyframes slideDownFaq { from {opacity:0;transform:translateY(-5px);} to {opacity:1;transform:translateY(0);} }
</style>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.faq-question').forEach(question => {
      question.addEventListener('click', () => {
        question.parentElement.classList.toggle('active');
      });
    });

    const faqSearchInput = document.getElementById('faqSearch');
    if (faqSearchInput) {
        faqSearchInput.addEventListener('input', function () {
            const query = this.value.toLowerCase();
            document.querySelectorAll('#faqContainer .faq-item').forEach(item => {
            const text = item.innerText.toLowerCase();
            item.style.display = text.includes(query) ? 'block' : 'none';
            });
        });
    }
  });

  function toggleAllFaq(expand) {
    document.querySelectorAll('#faqContainer .faq-item').forEach(item => {
      item.classList.toggle('active', expand);
    });
  }

  function speakFaqText(el) {
    const textElement = el.parentElement.querySelector('[itemprop="text"]');
    if (textElement) {
        const text = textElement.innerText;
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'en-US'; // Consider making this dynamic with page language
        window.speechSynthesis.speak(utter);
    }
  }
</script>

<!-- RATING WIDGET -->
<section id="ratingWidgetContainer" class="animate"> <!-- Added animate -->
    <div class="rating-box" id="ratingWidget">
      <h2>Rate This Tool</h2>
      <p>How helpful was the Phone Speaker Cleaner?</p>
      <div class="stars" id="stars">
        <span class="star" data-value="1">‚òÖ</span><span class="star" data-value="2">‚òÖ</span>
        <span class="star" data-value="3">‚òÖ</span><span class="star" data-value="4">‚òÖ</span>
        <span class="star" data-value="5">‚òÖ</span>
      </div>
      <div class="emoji" id="emoji"></div>
      <div id="ratingResult">Select a rating</div>
      <textarea id="comment" placeholder="Write a comment..."></textarea>
      <button id="submitBtn">Submit Feedback</button>
      <div id="thankYou"></div>
      <div id="avgRating"></div>
      <canvas id="confettiCanvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; background: transparent;"></canvas>
    </div>
</section>
<style>
#ratingWidgetContainer { background: var(--current-card-bg) !important; } /* Override transparent section */
#ratingWidget {
  /* width: 100%; */ /* Handled by section */
  /* background: transparent; */ /* Inherits from section */
  color: var(--current-text);
  padding: 20px; text-align: center; box-sizing: border-box;
  font-family: sans-serif; position: relative; overflow: hidden;
}
#ratingWidget h2, #ratingWidget p { margin: 0 0 10px; color: var(--current-text); }
#ratingWidget .stars { display:flex; justify-content:center; gap:12px; margin:10px 0; }
#ratingWidget .star {
  font-size:2.2rem; color:#ccc; cursor:pointer; transition:transform 0.2s, color 0.3s;
}
body.dark-mode #ratingWidget .star { color: #555; }
#ratingWidget .star.selected, #ratingWidget .star.hovered { color:#ffc107; transform:scale(1.3); }
#ratingWidget #emoji { font-size:1.8rem; height:28px; margin:4px 0 15px; }
#ratingWidget #ratingResult { color: var(--current-text); }
#ratingWidget textarea {
  width:100%; max-width:480px; margin:12px auto; padding:10px; font-size:15px;
  border-radius:8px; border:1px solid var(--current-input-border); display:block;
  background:var(--current-input-bg); color:var(--current-input-text);
}
#ratingWidget button#submitBtn { /* More specific */
  display:block; margin:12px auto; padding:10px 22px; font-size:15px;
  border:none; border-radius:6px; background:var(--primary); color:var(--primary-text);
  cursor:pointer; transition:background 0.3s ease;
}
#ratingWidget button#submitBtn:hover { filter:brightness(90%); }
#ratingWidget #thankYou { margin-top:10px; font-size:14px; font-weight:bold; color:green; }
#ratingWidget #avgRating { margin-top:10px; font-size:13px; color:var(--current-text-muted); }
</style>
<script>
(() => {
  const ratingWidget = document.getElementById('ratingWidget');
  if (!ratingWidget) return; // Guard if section is missing

  const stars = ratingWidget.querySelectorAll('.star'),
    ratingResult = ratingWidget.querySelector('#ratingResult'),
    emoji = ratingWidget.querySelector('#emoji'),
    thankYou = ratingWidget.querySelector('#thankYou'),
    submitBtn = ratingWidget.querySelector('#submitBtn'),
    commentBox = ratingWidget.querySelector('#comment'),
    avgRating = ratingWidget.querySelector('#avgRating'),
    confettiCanvas = ratingWidget.querySelector('#confettiCanvas');
    
  if (!stars.length || !ratingResult || !emoji || !thankYou || !submitBtn || !commentBox || !avgRating || !confettiCanvas) return; // Guard elements

  const ctx = confettiCanvas.getContext('2d');

  let selected = localStorage.getItem('userRating') || 0;
  let ratings = JSON.parse(localStorage.getItem('ratings') || '[]');
  const emojiMap = {1:'üò†',2:'‚òπÔ∏è',3:'üòê',4:'üôÇ',5:'üòç'};
  commentBox.value = localStorage.getItem('userComment') || '';
  commentBox.oninput = () => localStorage.setItem('userComment', commentBox.value);

  function updateStarsUI(val, isSel) {
    stars.forEach(s => {
      s.classList.remove('hovered', 'selected');
      if (s.dataset.value <= val) s.classList.add(isSel ? 'selected' : 'hovered');
    });
  }
  function showAverageRating() {
    if (ratings.length) {
      let avg = (ratings.reduce((a, b) => +a + +b, 0) / ratings.length).toFixed(1);
      avgRating.textContent = `Average: ${avg} stars from ${ratings.length} votes`;
    } else {
        avgRating.textContent = '';
    }
  }
  showAverageRating();

  if (selected > 0) {
    updateStarsUI(selected, true); // Use 'true' for selected
    emoji.textContent = emojiMap[selected];
    ratingResult.textContent = `You rated: ${selected} star${selected > 1 ? 's' : ''}`;
  }
  stars.forEach(s => {
    s.onmouseover = () => {
      updateStarsUI(s.dataset.value, false); // Use 'false' for hovered
      emoji.textContent = emojiMap[s.dataset.value];
      emoji.style.transform = 'scale(1.2)';
    };
    s.onmouseout = () => {
      updateStarsUI(selected, true); // Revert to selected state
      emoji.textContent = emojiMap[selected] || '';
      emoji.style.transform = 'scale(1)';
    };
    s.onclick = () => {
      selected = s.dataset.value;
      localStorage.setItem('userRating', selected);
      updateStarsUI(selected, true);
      emoji.textContent = emojiMap[selected];
      ratingResult.textContent = `You rated: ${selected} star${selected > 1 ? 's' : ''}`;
    };
  });
  submitBtn.onclick = () => {
    if (!selected || selected === "0") return alert("Select a rating first.");
    const comment = commentBox.value.trim();
    // if (comment && comment.length < 5) return alert("Comment is too short."); // Optional validation
    submitBtn.disabled = true; submitBtn.textContent = "Submitting...";
    fetch("https://getform.io/f/bwnqxvea", { // Replace with your endpoint if changed
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({rating: selected, emoji: emojiMap[selected], comment})
    }).then(res => {
      if (res.ok) {
        thankYou.textContent = "Thanks for your feedback!";
        thankYou.style.color = "var(--success)"; // Use CSS var
        if (!ratings.find(r => r.ts === selected.ts)) { // Prevent duplicate if resubmitted quickly
            ratings.push(selected); // Storing just the rating value
            localStorage.setItem('ratings', JSON.stringify(ratings));
        }
        localStorage.removeItem('userComment'); showAverageRating(); launchConfettiAnimation();
      } else throw new Error("Submission failed");
    }).catch(() => {
      thankYou.textContent = "Submission failed.";
      thankYou.style.color = "var(--danger)"; // Use CSS var
    }).finally(() => {
      setTimeout(() => {
        submitBtn.disabled = false; submitBtn.textContent = "Submit Feedback";
        commentBox.value = ""; thankYou.textContent = ""; selected = 0; updateStarsUI(0, true); emoji.textContent = ""; ratingResult.textContent = "Select a rating";
      }, 5000);
    });
  };

  function launchConfettiAnimation() {
    let w = confettiCanvas.width = confettiCanvas.offsetWidth,
        h = confettiCanvas.height = confettiCanvas.offsetHeight,
        particles = Array.from({length: 100}, () => ({
          x: Math.random() * w, y: Math.random() * h - h, // Start above canvas
          vx: Math.random() * 4 - 2, vy: Math.random() * 2 + 1, // Slower fall
          size: Math.random() * 5 + 3,
          color: `hsl(${Math.random()*360}, 100%, 60%)`,
          alpha: 1
        }));
    let frame = 0;
    (function animateConfetti(){
      ctx.clearRect(0, 0, w, h);
      particles.forEach(p => {
        p.x += p.vx; p.y += p.vy; p.alpha -= 0.005; // Fade out
        // p.vy += 0.05; // Gravity
        if (p.y > h || p.x < 0 || p.x > w || p.alpha <= 0) { // Reset particle
            p.y = Math.random() * -20; p.x = Math.random() * w; p.alpha = 1;
            p.vx = Math.random() * 4 - 2; p.vy = Math.random() * 2 + 1;
        }
        ctx.globalAlpha = p.alpha > 0 ? p.alpha : 0;
        ctx.fillStyle = p.color;
        ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, 2 * Math.PI); ctx.fill();
      });
      ctx.globalAlpha = 1; // Reset alpha
      if (++frame < 200) requestAnimationFrame(animateConfetti); // Run for ~3 seconds
      else ctx.clearRect(0,0,w,h); // Clear at the end
    })();
  }
})();
</script>

<!-- TESTIMONIAL SECTION -->
<section id="testimonial-section" class="animate"> <!-- Added animate -->
  <h2 class="testimonial-title">üí¨ What Users Are Saying</h2>
  <div class="testimonial-carousel" onmouseover="pauseSlider()" onmouseout="startSlider()">
    <div class="testimonial-slide active">
      <a href="https://Fixedmyspeaker.com" target="_blank"><img class="testimonial-img" src="https://i.postimg.cc/y86Ct8qy/Untitled-design.png" alt="User photo Bishal Mishra" /></a>
      <p class="testimonial-text">‚ÄúMy phone speaker was barely audible after I dropped it in the sink. This tool worked wonders within minutes! Big thanks to the team for creating something so helpful.‚Äù</p>
      <h3 class="testimonial-name">Bishal Mishra</h3><p class="testimonial-role">üì± App Developer</p>
    </div>
    <div class="testimonial-slide">
      <a href="https://fixedmyspeaker.com" target="_blank"><img class="testimonial-img" src="https://i.postimg.cc/65fNMGPQ/Untitled-design.png" alt="User photo Prashant Mishra" /></a>
      <p class="testimonial-text">‚ÄúWas skeptical at first, but after running the cleaner twice, my speaker volume improved drastically. I didn‚Äôt have to go to a repair shop. Highly recommended for anyone facing muffled audio.‚Äù</p>
      <h3 class="testimonial-name">Prashant Mishra</h3><p class="testimonial-role">üéß Gadget Enthusiast</p>
    </div>
    <div class="testimonial-slide">
      <a href="https://Fixedmyspeaker.com" target="_blank"><img class="testimonial-img" src="https://i.postimg.cc/GhCCPjqN/Untitled-design.png" alt="User photo Anam Mishra" /></a>
      <p class="testimonial-text">‚ÄúThis website is a lifesaver! Clean interface, easy to use, and it really does the job. My friends didn‚Äôt believe it until they tried it themselves. Super handy after water exposure.‚Äù</p>
      <h3 class="testimonial-name">Anam Mishra</h3><p class="testimonial-role">üåü Verified User</p>
    </div>
    <div class="testimonial-nav">
      <button class="testimonial-dot active" onclick="changeSlide(0)" aria-label="Show testimonial 1"></button>
      <button class="testimonial-dot" onclick="changeSlide(1)" aria-label="Show testimonial 2"></button>
      <button class="testimonial-dot" onclick="changeSlide(2)" aria-label="Show testimonial 3"></button>
    </div>
  </div>
</section>
<style>
  #testimonial-section { /* Wrapper style */
    background: transparent !important;
    box-shadow: none !important;
    padding: 40px 20px !important;
    text-align: center;
  }
  .testimonial-title { font-size: 28px; color: var(--current-text); margin-bottom: 20px; }
  .testimonial-carousel { position:relative; max-width:800px; margin:auto; overflow:hidden; } /* Max width was 100% */
  .testimonial-slide {
    display:none; text-align:center; padding:30px 20px;
    background:var(--current-card-bg); border-radius:10px;
    animation:fadeSlideIn 0.5s ease-in-out; /* Renamed animation */
    /* max-width: 800px; margin: auto; */ /* Handled by carousel now */
  }
  .testimonial-slide.active { display:block; }
  .testimonial-img {
    width:100px; height:100px; object-fit:cover; border-radius:50%;
    margin-bottom:15px; box-shadow:0 0 5px rgba(0,0,0,0.1);
  }
  .testimonial-text { font-size:18px; font-style:italic; color:var(--current-text-muted); margin:10px 0 20px; }
  .testimonial-name { font-size:20px; font-weight:bold; color:var(--primary); margin-bottom:4px; }
  .testimonial-role { font-size:14px; color:var(--current-text-muted); }
  .testimonial-nav { text-align:center; margin-top:20px; }
  .testimonial-dot {
    height:12px; width:12px; margin:0 6px; background-color:var(--current-border);
    border-radius:50%; display:inline-block; cursor:pointer;
    transition:background-color 0.3s ease; border:none; padding:0;
  }
  .testimonial-dot.active { background-color:var(--primary); }
  .testimonial-dot:focus { outline:2px solid var(--primary); }
  @keyframes fadeSlideIn { from {opacity:0;transform:translateY(10px);} to {opacity:1;transform:translateY(0);} }
  @media (max-width:600px) {
    .testimonial-text {font-size:16px;} .testimonial-name {font-size:18px;} .testimonial-role {font-size:13px;}
  }
</style>
<script>
  let currentSlideIdx = 0; // Renamed from currentSlide to avoid conflict if any
  const testimonialSlides = document.querySelectorAll('#testimonial-section .testimonial-slide');
  const testimonialDots = document.querySelectorAll('#testimonial-section .testimonial-dot');
  let testimonialSlideInterval;

  function changeSlide(index) {
    if (testimonialSlides.length === 0 || !testimonialSlides[currentSlideIdx] || !testimonialDots[currentSlideIdx]) return;
    testimonialSlides[currentSlideIdx].classList.remove('active');
    testimonialDots[currentSlideIdx].classList.remove('active');
    currentSlideIdx = index;
    testimonialSlides[currentSlideIdx].classList.add('active');
    testimonialDots[currentSlideIdx].classList.add('active');
  }

  function nextTestimonialSlide() {
    if (testimonialSlides.length === 0) return;
    let next = (currentSlideIdx + 1) % testimonialSlides.length;
    changeSlide(next);
  }

  function startSlider() {
    if (testimonialSlides.length === 0) return;
    clearInterval(testimonialSlideInterval); // Clear existing before starting new
    testimonialSlideInterval = setInterval(nextTestimonialSlide, 5000);
  }

  function pauseSlider() {
    clearInterval(testimonialSlideInterval);
  }
  
  document.addEventListener('DOMContentLoaded', () => {
    const carousel = document.querySelector('#testimonial-section .testimonial-carousel');
    if (carousel) {
        carousel.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; });
        carousel.addEventListener('touchend', e => {
            let touchEndX = e.changedTouches[0].screenX;
            if (touchEndX < touchStartX - 50) nextTestimonialSlide();
            if (touchEndX > touchStartX + 50) {
            let prev = (currentSlideIdx - 1 + testimonialSlides.length) % testimonialSlides.length;
            changeSlide(prev);
            }
        });
    }
    if (testimonialSlides.length > 0) { // Start slider only if slides exist
        startSlider();
    }
  });

  // Keyboard navigation (optional, ensure no conflicts)
  // document.addEventListener('keydown', e => { /* ... */ });
</script>

<!-- SUBSCRIBE SECTION -->
<section id="subscribe-section" class="animate"> <!-- Added animate -->
  <h2>üì¢ Subscribe for Updates</h2>
  <p>Stay in the loop with our latest tools, features, and offers.</p>
  <form id="gmailSubscribeForm">
    <input type="email" id="gmailInput" placeholder="Your Gmail address" required pattern="^[a-zA-Z0-9._%+-]+@gmail\.com$"/>
    <button type="submit">üîî Subscribe</button>
    <p id="subscribeMsg" style="display: none;">‚úÖ Subscribed!</p>
  </form>
  <button onclick="promptAdminAccess()" id="adminViewEmailsBtn">üîê Admin: View Emails</button>
</section>
<style>
#subscribe-section { /* This section uses its own gradient */
  padding:40px 20px; text-align:center; border-radius:15px;
  margin:40px auto; max-width:700px; box-shadow:0 8px 24px rgba(0,0,0,0.2);
  background:linear-gradient(145deg, #00bcd4, #3f51b5); color:#fff;
}
body.dark-mode #subscribe-section {
  background:linear-gradient(145deg, #1d5f6a, #2c3a85); color:var(--dark-text);
}
#subscribe-section h2, #subscribe-section p { margin-bottom:10px; }
#subscribe-section p { opacity:0.9; }
#subscribe-section form { display:flex; flex-direction:column; gap:10px; align-items:center; }
#subscribe-section input[type="email"] {
  padding:10px 18px; width:100%; max-width:360px; border-radius:25px;
  border:none; outline:none; font-size:15px;
  background-color:#fff; color:#333; /* Always light input on this gradient */
}
body.dark-mode #subscribe-section input[type="email"] {
  background-color:rgba(255,255,255,0.9); color:#333;
}
#subscribe-section button[type="submit"] {
  padding:10px 24px; background:#fff; color:#3f51b5;
  border:none; border-radius:25px; font-weight:bold; font-size:15px;
  cursor:pointer; transition:background 0.3s;
}
body.dark-mode #subscribe-section button[type="submit"] {
  background:rgba(255,255,255,0.9); color:#2c3a85;
}
#subscribe-section #adminViewEmailsBtn { /* Admin button on gradient */
  margin-top:16px; font-size:13px; padding:6px 14px; border-radius:18px;
  background:rgba(255,255,255,0.15); border:1px solid #fff; color:#fff; cursor:pointer;
}
body.dark-mode #subscribe-section #adminViewEmailsBtn {
  background:rgba(0,0,0,0.15); border:1px solid var(--dark-text-muted); color:var(--dark-text);
}
</style>
<script>
  const ADMIN_PASSWORD_SUB = "bishal"; // Use a different const name
  function promptAdminAccess() { /* ... same as before ... */ }
  function openEmailAdmin() { /* ... same as before ... */ }
  function closeEmailAdmin() { /* ... same as before ... */ }
  function clearEmails() { /* ... same as before ... */ }
  function downloadEmails() { /* ... same as before ... */ }
  document.addEventListener('DOMContentLoaded', () => {
    const gmailSubForm = document.getElementById("gmailSubscribeForm");
    if (gmailSubForm) {
        gmailSubForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const input = document.getElementById("gmailInput");
            const email = input.value.trim();
            const message = document.getElementById("subscribeMsg");

            if (/^[a-zA-Z0-9._%+-]+@gmail\.com$/.test(email)) {
            let emails = JSON.parse(localStorage.getItem("subscribedGmails") || "[]");
            if (!emails.includes(email)) {
                emails.push(email);
                localStorage.setItem("subscribedGmails", JSON.stringify(emails));
                message.style.color = "#d4f5d4"; // Success green
                message.textContent = "‚úÖ Thank you for subscribing!";
            } else {
                message.style.color = "#ffc107"; // Warning yellow
                message.textContent = "‚ö†Ô∏è You've already subscribed!";
            }
            input.value = "";
            } else {
            message.style.color = "orange";
            message.textContent = "‚ö†Ô∏è Please enter a valid Gmail address.";
            }
            message.style.display = "block";
            setTimeout(() => { message.style.display = "none"; }, 4000);
        });
    }
  });
</script>
<!-- Admin Modal HTML (same as before) -->
<div id="emailAdminModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:9999;">
  <div style="background:var(--current-card-bg); color:var(--current-text); width:90%; max-width:500px; margin:60px auto; padding:25px; border-radius:10px; position:relative; box-shadow: 0 6px 20px rgba(0,0,0,0.15);">
    <h3 style="margin-top:0;">üìÑ Subscribed Gmail List</h3>
    <ul id="emailList" style="max-height:240px; overflow:auto; padding-left: 20px; margin: 10px 0;"></ul>
    <div style="margin-top:15px; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
      <button onclick="downloadEmails()" style="padding:7px 14px; background:var(--success); color:var(--primary-text); border:none; border-radius:6px; cursor:pointer;">‚¨áÔ∏è Download</button>
      <button onclick="clearEmails()" style="padding:7px 14px; background:var(--danger); color:var(--primary-text); border:none; border-radius:6px; cursor:pointer;">üóëÔ∏è Clear All</button>
      <button onclick="closeEmailAdmin()" style="padding:7px 14px; background:var(--current-text-muted); color:var(--current-bg); border:none; border-radius:6px; cursor:pointer;">‚ùå Close</button>
    </div>
  </div>
</div>


  <footer>¬© Bishal Mishra 2025  | All rights reserved.</footer>

<!-- Main App Logic & Translations -->
<script>
    let audioCtx, oscillator, gainNode, countdownIntervalGlobal; // Renamed countdownInterval
    let currentCountdown = 30; // Renamed countdown

    function startCleaning() {
      stopSound(); 
      const freqSlider = document.getElementById('freqSlider');
      if (!freqSlider) { console.error("Frequency slider not found!"); return; }
      const freq = parseInt(freqSlider.value);

      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      oscillator = audioCtx.createOscillator();
      gainNode = audioCtx.createGain();

      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime); // Set initial gain
      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);
      oscillator.start();
      playClickSound(); // Play click sound on start

      currentCountdown = 30;
      const countdownDisplay = document.getElementById('countdown');
      if (countdownDisplay) countdownDisplay.textContent = currentCountdown;
      
      clearInterval(countdownIntervalGlobal); // Clear previous interval
      countdownIntervalGlobal = setInterval(() => {
        currentCountdown--;
        if (countdownDisplay) countdownDisplay.textContent = currentCountdown;
        if (currentCountdown <= 0) stopSound();
      }, 1000);
    }

    function stopSound() {
      if (oscillator) {
        try { oscillator.stop(); } catch (e) {}
        oscillator.disconnect();
        oscillator = null;
      }
      if (gainNode) {
        gainNode.disconnect();
        gainNode = null;
      }
      if (audioCtx) {
        try { audioCtx.close(); } catch (e) {}
        audioCtx = null;
      }
      clearInterval(countdownIntervalGlobal);
      const countdownDisplay = document.getElementById('countdown');
      if (countdownDisplay) countdownDisplay.textContent = 0; // Reset to 0 or initial value
    }

    // updateFrequencyLabel is already defined near its slider HTML

    const translations = { /* ... Same translations object ... */ };
    function changeLanguage(event) { /* ... Same changeLanguage function ... */ }
    function shareTool() { /* ... Same shareTool function ... */ }
    // scrollToTop is handled by its own script block now
    // saveCleaningHistory and updateHistoryUI if needed (were in original)
</script>

<!-- Click sound source (if needed globally, or can be specific) -->
<audio id="clickSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<script>
  // Global click sound player (if used by many elements)
  function playClickSound() { // Ensure this is the one being called
    const clickAudio = document.getElementById("clickSound"); // Corrected ID
    if (clickAudio && clickAudio.play) { // Check if play is a function
        clickAudio.currentTime = 0; // Rewind to start
        clickAudio.play().catch(error => console.error("Error playing click sound:", error));
    }
  }
  // Add to all buttons if desired
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('button, a.btn, .faq-question, .read-more').forEach(btn => { // Added more selectors
        // btn.addEventListener('click', playClickSound); // Uncomment this if you want all these to make sound
        // Be careful, some might have their own onclick that calls it already
    });
  });
</script>

<!-- Profile Icon & Auth Related HTML -->
<div id="profileToggle" style="position:fixed;top:10px;right:10px;cursor:pointer;z-index:9999;">
  <img src="https://cdn-icons-png.flaticon.com/512/1144/1144760.png" id="profileIcon" alt="Profile Icon" style="width:40px;height:40px;border-radius:50%;">
</div>
<div id="profileMenu" style="display:none;position:absolute;top:60px;right:10px;background:var(--current-profile-menu-bg);border:1px solid var(--current-profile-menu-border);border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);width:240px;font-family:sans-serif;z-index:9999;color:var(--current-text);">
  <div style="padding:12px;border-bottom:1px solid var(--current-profile-menu-border);display:flex;align-items:center;">
    <img id="menuPhoto" src="" style="width:40px;height:40px;border-radius:50%;margin-right:10px;">
    <div>
      <div id="menuName" style="font-weight:bold;font-size:14px;"></div>
      <div id="menuEmail" style="font-size:12px;color:var(--current-text-muted);"></div>
      <div id="emailVerified" style="font-size:11px;color:var(--current-text-muted);"></div> <!-- Color needs to be checked -->
    </div>
  </div>
  <div onclick="triggerProfileUpload()" style="padding:10px;cursor:pointer;border-bottom:1px solid var(--current-profile-menu-border);">‚úèÔ∏è Edit Profile Photo</div>
  <div onclick="sendVerificationEmail()" style="padding:10px;cursor:pointer;border-bottom:1px solid var(--current-profile-menu-border);">‚úÖ Verify Email</div>
  <div onclick="sendResetPassword()" style="padding:10px;cursor:pointer;border-bottom:1px solid var(--current-profile-menu-border);">üîê Reset Password</div>
  <div onclick="logoutUser()" style="padding:10px;cursor:pointer;">üö™ Logout</div> <!-- Renamed logout to logoutUser -->
</div>
<input type="file" id="uploadProfileInput" accept="image/*" style="display:none;">

<div id="authPopup" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--current-card-bg);padding:2rem;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,0.2);z-index:9999;width:90%;max-width:400px;color:var(--current-text);">
  <h3 id="formTitle">Sign In</h3>
  <input id="email" type="email" placeholder="Email" style="width:100%;padding:10px;margin-bottom:8px;background:var(--current-input-bg);color:var(--current-input-text);border:1px solid var(--current-input-border);box-sizing:border-box;">
  <input id="password" type="password" placeholder="Password" style="width:100%;padding:10px;margin-bottom:8px;background:var(--current-input-bg);color:var(--current-input-text);border:1px solid var(--current-input-border);box-sizing:border-box;">
  <button id="authAction" style="width:100%;padding:10px;margin-bottom:10px;background:var(--primary);color:var(--primary-text);border:none;border-radius:4px;">Sign In</button>
  <button id="googleSignIn" style="width:100%;padding:10px;background:#db4437;color:white;border:none;margin-bottom:10px;border-radius:4px;">Sign in with Google</button>
  <p style="text-align:center;font-size:14px;"><span id="toggleAuth" style="color:var(--current-link-color);cursor:pointer;">Don't have an account? Sign Up</span></p>
</div>

<!-- Firebase Auth Script (MUST BE type="module") -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import {
    getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider,
    signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut,
    sendPasswordResetEmail, sendEmailVerification, updateProfile
  } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";
  // FCM (Push Notifications) - Import if used, ensure firebase-messaging-sw.js is set up
  // import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging.js";


  const firebaseConfig = { // IMPORTANT: Replace with your actual Firebase config
    apiKey: "AIzaSyDpIY1tJ9hJQ_Dmnz6HEBu1-gkyhMbl7D8", // From your Firebase project settings
    authDomain: "speakercleanerapp.firebaseapp.com",
    projectId: "speakercleanerapp",
    storageBucket: "speakercleanerapp.appspot.com",
    messagingSenderId: "757487409389",
    appId: "1:757487409389:web:15a6b21a17a973dace14e4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const googleProvider = new GoogleAuthProvider(); // Renamed to avoid conflict
  const storage = getStorage(app); // Pass app to getStorage
  // const messaging = getMessaging(app); // Initialize if using FCM

  const profileToggleEl = document.getElementById('profileToggle'); // Renamed
  const profileMenuEl = document.getElementById('profileMenu');   // Renamed
  const authPopupEl = document.getElementById('authPopup');     // Renamed
  const authActionBtn = document.getElementById('authAction');    // Renamed
  const toggleAuthLink = document.getElementById('toggleAuth');   // Renamed
  const googleSignInBtn = document.getElementById('googleSignIn'); // Renamed
  const uploadProfileInputEl = document.getElementById('uploadProfileInput'); // Renamed

  let isSignUpForm = false; // Renamed

  if (profileToggleEl) {
    profileToggleEl.addEventListener('click', () => {
        if (auth.currentUser) {
        profileMenuEl.style.display = profileMenuEl.style.display === 'block' ? 'none' : 'block';
        } else {
        authPopupEl.style.display = 'block';
        isSignUpForm = false; // Default to sign in
        updateAuthFormUI();
        }
    });
  }

  document.addEventListener('click', (e) => { // Close profile menu on outside click
    if (profileMenuEl && profileToggleEl && authPopupEl) { // Check if elements exist
        if (!profileToggleEl.contains(e.target) && !profileMenuEl.contains(e.target) && profileMenuEl.style.display === 'block') {
            profileMenuEl.style.display = 'none';
        }
        // Optional: Close auth popup on outside click (more complex, requires checking if click is inside popup)
    }
  });

  function updateAuthFormUI() {
    if(document.getElementById('formTitle')) document.getElementById('formTitle').innerText = isSignUpForm ? 'Sign Up' : 'Sign In';
    if(authActionBtn) authActionBtn.innerText = isSignUpForm ? 'Sign Up' : 'Sign In';
    if(toggleAuthLink) toggleAuthLink.innerText = isSignUpForm ? 'Already have an account? Sign In' : "Don't have an account? Sign Up";
  }
  
  if (toggleAuthLink) {
    toggleAuthLink.addEventListener('click', () => {
        isSignUpForm = !isSignUpForm;
        updateAuthFormUI();
    });
  }

  if (authActionBtn) {
    authActionBtn.addEventListener('click', async () => {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        if (!email || !password) return alert("Please fill in both email and password.");
        try {
        isSignUpForm
            ? await createUserWithEmailAndPassword(auth, email, password)
            : await signInWithEmailAndPassword(auth, email, password);
        if(authPopupEl) authPopupEl.style.display = 'none';
        } catch (err) {
        alert("Auth Error: " + err.message);
        }
    });
  }

  if (googleSignInBtn) {
    googleSignInBtn.addEventListener('click', async () => {
        try {
        await signInWithPopup(auth, googleProvider);
        if(authPopupEl) authPopupEl.style.display = 'none';
        } catch (err) {
        alert("Google Sign-In Error: " + err.message);
        }
    });
  }
  
  // Make functions available globally for onclick attributes from HTML
  window.logoutUser = async () => { // Renamed from logout
    try { await signOut(auth); /* location.reload(); // Reload can be disruptive */ }
    catch (e) { alert("Logout failed: " + e.message); }
  };

  window.triggerProfileUpload = () => { if(uploadProfileInputEl) uploadProfileInputEl.click(); };
  
  window.sendVerificationEmail = async () => {
    if (auth.currentUser && !auth.currentUser.emailVerified) {
      try { await sendEmailVerification(auth.currentUser); alert("Verification email sent."); }
      catch(e) { alert("Error sending verification: " + e.message); }
    } else if (auth.currentUser && auth.currentUser.emailVerified) {
      alert("Your email is already verified.");
    } else {
      alert("Please sign in to verify your email.");
    }
  };

  window.sendResetPassword = async () => {
    if (auth.currentUser?.email) {
      try { await sendPasswordResetEmail(auth, auth.currentUser.email); alert("Password reset email sent."); }
      catch(e) { alert("Error sending reset email: " + e.message); }
    } else {
      const emailForReset = prompt("Please enter your email address to send a password reset link:");
      if (emailForReset) {
        try { await sendPasswordResetEmail(auth, emailForReset); alert("Password reset email sent to " + emailForReset); }
        catch(e) { alert("Error sending reset email: " + e.message); }
      }
    }
  };

  onAuthStateChanged(auth, (user) => {
    const profileIconEl = document.getElementById('profileIcon');
    const menuPhotoEl = document.getElementById('menuPhoto');
    const menuNameEl = document.getElementById('menuName');
    const menuEmailEl = document.getElementById('menuEmail');
    const emailVerifiedEl = document.getElementById('emailVerified');

    if (user) {
      const photo = user.photoURL || 'https://cdn-icons-png.flaticon.com/512/847/847969.png'; // Default avatar
      const name = user.displayName || user.email.split('@')[0];
      const verifiedText = user.emailVerified ? "Verified" : "Not Verified";
      const verifiedColor = user.emailVerified ? "var(--success)" : "var(--danger)";


      if(profileIconEl) profileIconEl.src = photo;
      if(menuPhotoEl) menuPhotoEl.src = photo;
      if(menuNameEl) menuNameEl.innerText = name;
      if(menuEmailEl) menuEmailEl.innerText = user.email;
      if(emailVerifiedEl) {
          emailVerifiedEl.innerText = verifiedText;
          emailVerifiedEl.style.color = verifiedColor;
      }
      if(authPopupEl) authPopupEl.style.display = 'none'; // Hide auth popup if user is signed in
    } else { // User is signed out
      if(profileIconEl) profileIconEl.src = 'https://cdn-icons-png.flaticon.com/512/1144/1144760.png'; // Default guest icon
      if(profileMenuEl) profileMenuEl.style.display = 'none'; // Hide profile menu
      // Don't automatically show authPopupEl on sign out, let user click profile icon
    }
  });

  if (uploadProfileInputEl) {
    uploadProfileInputEl.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file || !auth.currentUser) return alert("No file selected or user not signed in.");
        const user = auth.currentUser;
        const fileRef = ref(storage, `profiles/${user.uid}/${file.name}`); // Include file name for uniqueness
        try {
        await uploadBytes(fileRef, file);
        const photoURL = await getDownloadURL(fileRef);
        await updateProfile(user, { photoURL });
        // Update UI immediately (already handled by onAuthStateChanged if photoURL changes, but explicit is fine)
        if(document.getElementById('profileIcon')) document.getElementById('profileIcon').src = photoURL;
        if(document.getElementById('menuPhoto')) document.getElementById('menuPhoto').src = photoURL;
        alert("Profile picture updated.");
        } catch (err) {
        alert("Upload failed: " + err.message);
        }
    });
  }

  // Firebase Cloud Messaging (Push Notifications)
  // Make sure firebase-messaging-sw.js is present in your root directory
  /*
  if ('serviceWorker' in navigator && typeof getMessaging === 'function') {
    navigator.serviceWorker.register('/firebase-messaging-sw.js')
      .then(function (registration) {
        console.log('‚úÖ Service Worker registered:', registration);
        Notification.requestPermission().then((permission) => {
          if (permission === 'granted') {
            getToken(messaging, {
              vapidKey: "YOUR_VAPID_KEY_HERE", // Replace with your VAPID key from Firebase Console
              serviceWorkerRegistration: registration
            }).then((currentToken) => {
              if (currentToken) { console.log('üîî FCM Token:', currentToken); }
              else { console.warn('No FCM token. User may have denied permission.'); }
            }).catch((err) => { console.error('‚ùå Error getting FCM token:', err); });
          } else { console.warn('Notification permission not granted'); }
        });
      }).catch(function (err) { console.error('‚ùå SW registration failed:', err); });
  }
  */
</script>


<!-- Dark/Light Mode Toggle JS (should be one of the last scripts) -->
<script>
   const darkModeToggle = document.getElementById('darkModeToggleCheckbox');
   const body = document.body;
   const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
   const currentTheme = localStorage.getItem('themePreference');

   function setTheme(theme) {
       if (theme === 'dark') {
           body.classList.add('dark-mode');
           if(darkModeToggle) darkModeToggle.checked = true;
       } else {
           body.classList.remove('dark-mode');
           if(darkModeToggle) darkModeToggle.checked = false;
       }
       // Icon color update is handled by CSS now for simplicity
   }

   if (currentTheme) {
       setTheme(currentTheme);
   } else {
       setTheme(prefersDarkScheme.matches ? 'dark' : 'light');
   }

   if(darkModeToggle) {
        darkModeToggle.addEventListener('change', (event) => {
            const newTheme = event.target.checked ? 'dark' : 'light';
            localStorage.setItem('themePreference', newTheme);
            setTheme(newTheme);
        });
   }

   prefersDarkScheme.addEventListener('change', (event) => { // Listen for OS theme changes
       if (!localStorage.getItem('themePreference')) { // Only if no user preference set
           setTheme(event.matches ? 'dark' : 'light');
       }
   });
   
   // Ensure all animations get triggered after load
   window.addEventListener('load', () => {
      document.getElementById('loader').style.display = 'none';
      document.querySelectorAll('.animate').forEach((element, index) => {
        setTimeout(() => {
          element.classList.add('visible');
        }, index * 200); // Slightly faster animation stagger
      });
      // Initialize theme one last time after all DOM is surely ready
      // setTheme(localStorage.getItem('themePreference') || (prefersDarkScheme.matches ? 'dark' : 'light'));
      // The initial setTheme calls should cover this.
    });
</script>

</body>
</html>
